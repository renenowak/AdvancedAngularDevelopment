{"version":3,"file":"ajaxRecord.js","sourceRoot":"","sources":["../src/ajaxRecord.ts"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,kCAAkC;AAElC,OAAO,EAAE,aAAa,EAAE,SAAS,EAAE,aAAa,EAAE,MAAM,uCAAuC,CAAC;AAGhG;IAAA;QACW,aAAQ,GAAY,KAAK,CAAC;QAC1B,yBAAoB,GAAY,KAAK,CAAC;QACtC,aAAQ,GAAY,KAAK,CAAC;QAC1B,cAAS,GAAY,KAAK,CAAC;QAElC,mGAAmG;QAC5F,uCAAkC,GAAG,KAAK,CAAC;IACtD,CAAC;IAAD,yBAAC;AAAD,CAAC,AARD,IAQC;;AAED;IA8CI,oBAAY,OAAe,EAAE,MAAc,EAAE,MAAyB;QA7C/D,cAAS,GAAG,KAAK,CAAC;QAClB,uBAAkB,GAAG,IAAI,CAAC;QAC1B,mBAAc,GAAG,IAAI,CAAC;QACtB,SAAI,GAAG,IAAI,CAAC;QACZ,8BAAyB,GAAG,IAAI,CAAC;QACjC,qBAAgB,GAAG,IAAI,CAAC;QACxB,sBAAiB,GAAG,IAAI,CAAC;QACzB,YAAO,GAAG,IAAI,CAAC;QACf,YAAO,GAAG,IAAI,CAAC;QACf,eAAU,GAAG,IAAI,CAAC;QAClB,gBAAW,GAAG,CAAC,CAAC;QAChB,WAAM,GAAG,IAAI,CAAC;QAErB,oDAAoD;QAC7C,WAAM,GAAG,IAAI,CAAC;QAErB,gEAAgE;QACzD,oBAAe,GAAG,IAAI,CAAC;QAE9B,iEAAiE;QAC1D,wBAAmB,GAAG,IAAI,CAAC;QAElC,+DAA+D;QACxD,yBAAoB,GAAG,IAAI,CAAC;QAEnC,6FAA6F;QACtF,yBAAoB,GAAG,IAAI,CAAC;QAEnC,2DAA2D;QACpD,YAAO,GAAG,IAAI,CAAC;QAEtB,+DAA+D;QACxD,8BAAyB,GAAG,IAAI,CAAC;QAEjC,uBAAkB,GAAuB,IAAI,kBAAkB,EAAE,CAAC;QAEzE,uIAAuI;QAChI,kBAAa,GAAG,CAAC,CAAC;QAsBlB,qBAAgB,GAAG;YACtB,IAAM,IAAI,GAAG,IAAI,CAAC;YAClB,4BAA4B;YAC5B,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,WAAW,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,oBAAoB,CAAC,GAAG,IAAI,CAAC,GAAG,IAAI,CAAC;QAClI,CAAC,CAAA;QAjBG,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;QACvB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;IAC1B,CAAC;IAEM,mCAAc,GAArB;QACI,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;IAC9E,CAAC;IAEM,gCAAW,GAAlB;QACI,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,aAAa,CAAC,WAAW,CAAC,IAAI,CAAC,OAAO,EAAE,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;IACpI,CAAC;IAOL,iBAAC;AAAD,CAAC,AAjED,IAiEC;;AAAA,CAAC","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\nimport { DataSanitizer, UrlHelper, DateTimeUtils } from '@microsoft/applicationinsights-common';\r\nimport { IDiagnosticLogger } from '@microsoft/applicationinsights-core-js';\r\n\r\nexport class XHRMonitoringState {\r\n    public openDone: boolean = false;\r\n    public setRequestHeaderDone: boolean = false;\r\n    public sendDone: boolean = false;\r\n    public abortDone: boolean = false;\r\n\r\n    // <summary>True, if onreadyStateChangeCallback function attached to xhr, otherwise false</summary>\r\n    public onreadystatechangeCallbackAttached = false;\r\n}\r\n\r\nexport class ajaxRecord {\r\n    public completed = false;\r\n    public requestHeadersSize = null;\r\n    public requestHeaders = null;\r\n    public ttfb = null;\r\n    public responseReceivingDuration = null;\r\n    public callbackDuration = null;\r\n    public ajaxTotalDuration = null;\r\n    public aborted = null;\r\n    public pageUrl = null;\r\n    public requestUrl = null;\r\n    public requestSize = 0;\r\n    public method = null;\r\n\r\n    /// <summary>Returns the HTTP status code.</summary>\r\n    public status = null;\r\n\r\n    // <summary>The timestamp when open method was invoked</summary>\r\n    public requestSentTime = null;\r\n\r\n    // <summary>The timestamps when first byte was received</summary>\r\n    public responseStartedTime = null;\r\n\r\n    // <summary>The timestamp when last byte was received</summary>\r\n    public responseFinishedTime = null;\r\n\r\n    // <summary>The timestamp when onreadystatechange callback in readyState 4 finished</summary>\r\n    public callbackFinishedTime = null;\r\n\r\n    // <summary>The timestamp at which ajax was ended</summary>\r\n    public endTime = null;\r\n\r\n    // <summary>The original xhr onreadystatechange event</summary>\r\n    public originalOnreadystatechage = null;\r\n\r\n    public xhrMonitoringState: XHRMonitoringState = new XHRMonitoringState();\r\n\r\n    // <summary>Determines whether or not JavaScript exception occured in xhr.onreadystatechange code. 1 if occured, otherwise 0.</summary>\r\n    public clientFailure = 0;\r\n\r\n\r\n    public traceID: string;\r\n    public spanID: string;\r\n\r\n    private _logger: IDiagnosticLogger;\r\n\r\n    constructor(traceID: string, spanID: string, logger: IDiagnosticLogger) {\r\n        this.traceID = traceID;\r\n        this.spanID = spanID;\r\n        this._logger = logger;\r\n    }\r\n\r\n    public getAbsoluteUrl() {\r\n        return this.requestUrl ? UrlHelper.getAbsoluteUrl(this.requestUrl) : null;\r\n    }\r\n\r\n    public getPathName() {\r\n        return this.requestUrl ? DataSanitizer.sanitizeUrl(this._logger, UrlHelper.getCompleteUrl(this.method, this.requestUrl)) : null;\r\n    }\r\n\r\n    public CalculateMetrics = function () {\r\n        const self = this;\r\n        // round to 3 decimal points\r\n        self.ajaxTotalDuration = Math.round(DateTimeUtils.GetDuration(self.requestSentTime, self.responseFinishedTime) * 1000) / 1000;\r\n    }\r\n};\r\n\r\n"]}